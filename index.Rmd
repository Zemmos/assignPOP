---
title: "Intro to assignPOP"
output:
  html_document:
    self_contained: no
---

<img src="https://www.r-project.org/logo/Rlogo.svg" width="70" align="right"> 

**assignPOP** is an R package that helps perform population assignment using a machine-learning framework. It employs [supervised machine-learning](https://en.wikipedia.org/wiki/Supervised_learning) methods to evaluate the discriminatory power of your data collected from source populations, and is able to analyze **large genetic, non-genetic, or integrated (genetic plus non-genetic) data sets**. This framework is designed for solving the upward bias issue discussed in previous studies (Anderson 2010^[Anderson, E. C. (2010). Assessing the Power of Informative Subsets of Loci for Population Assignment: Standard Methods Are Upwardly Biased. *Molecular Ecology Resources* 10(4): 701–710.]; Waples 2010^[Waples, R. S. (2010). High-Grading Bias: Subtle Problems with Assessing Power of Selected Subsets of Loci for Population Assignment. *Molecular Ecology* 19(13): 2599–2601.]). Other features are listed as follows.

- Use principle component analysis (PCA) for dimensionality reduction (or data transformation)
- Use Monte-Carlo cross-validation to estimate mean and variance of assignment accuracy
- Use *K*-fold cross-validation to estimate membership probability
- Allow to resample various proportions or numbers of training individuals
- Allow to resample various proportions of training loci either randomly or based on locus *F~ST~* value
- Provide several machine-learning classification algorithms, including LDA, SVM, naive Bayes, decision tree, and random forest, to build tunable predictive models.
- Output results in publication-quality plots that can be edited using ggplot2 functions

[![Travis-CI Build Status](https://travis-ci.org/alexkychen/assignPOP.svg?branch=master)](https://travis-ci.org/alexkychen/assignPOP)
[![CRAN status](http://www.r-pkg.org/badges/version/assignPOP)](https://cran.r-project.org/package=assignPOP)
[![GitHub release](https://img.shields.io/github/release/alexkychen/assignPOP.svg)](https://github.com/alexkychen/assignPOP/releases)
[![license](https://img.shields.io/github/license/alexkychen/assignPOP.svg)](https://github.com/alexkychen/assignPOP/blob/master/LICENSE.md)

***
### Conceptual Framework

The ability to assign individuals of unknown origins to source populations relies on a robust baseline (or training data) collected from the source populations. However, noise in training data or lack of distinct features could lower the assignment ability. It is important to evaluate baseline data via cross-validation before using the baseline to predict source populations of individuals collected from unknown origins. The diagrams below illustrate how the assignPOP fits into such assignment framework, and the workflow for evaluting baseline data as well as predicting sources of unknonw individuals.

```{r, echo=FALSE}
DiagrammeR::grViz("
digraph conceptframe {
node [shape=box, fontname=Arial]
A [label='START:\nEvaluate baseline data collected\nfrom source populations\n(known individuals)']
B [label='Results:\nassignment accuracy\nor\nmembership probability']
C [label='Collect more data (features)\nfrom known individuals']
D [label='Collect unknown individuals\nto be predicted']
E [label='Perform assignment test\non unknown individuals']
F [label='Results:\npredicted populations\nand\nmembership probability']

edge [arrowhead=normal]
A -> B [label='analyze data via assignPOP\nsee Analytical Workflow step 1.', fontcolor=firebrick]
B -> C [label='bad results']
B -> D [label='good results']
D -> E 
E -> F [label='analyze data via assignPOP\nsee Analytical Workflow step 2.',fontcolor=firebrick]
C -> A [label='re-evaluate']

subgraph { rank=same; C; D; }
subgraph { rank=same; A; E; }
}
", height=350)
```

***
### Analytical Workflow {#analyticalworkflow}

```{r, echo=FALSE}
DiagrammeR::grViz("
digraph evaluatebaseline {
graph [rankdir = LR, ranksep=0.1, nodesep=0.3]
  
  node [shape=box, fontname=Arial]
  A [label='Step 1-1. Import data']
  B [label='Step 1-2.\nPerform resampling\ncross-validation']
  C [label='Step 1-3. Visualize results']
  
  node [shape=plaintext, fontname=Arial]
  1 [label='For genetic data, use\nread.genpop( ), reduce.allele( )']
  2 [label='For non-genetic data, use\nread.table( ), read.csv( )\n*data imported as a data frame']
  3 [label='For integrated data, use\nread.genpop( ), compile.data( )']
  5 [label='Monte-Carlo cross-validation\nassign.MC( )']
  6 [label='K-fold cross-validation\nassign.kfold( )']
  7 [label='Optional: Identify informative loci\ncheck.loci( )']
  8 [label='Assignment accuracy\naccuracy.MC( ), accuracy.kfold( ),\naccuracy.plot( )']
  9 [label='Membership probability\nmembership.plot( )']

  node [shape=plaintext, fontname=Arial, label='Step 1. Evaluate baseline data', fontsize=20]
  TT
  edge [arrowhead=normal]
  A -> B B -> C
  edge [arrowhead=tee]
  A -> 1  B -> 5  C -> 8
  edge [color=transparent]
  TT -> A
  1 -> 2 -> 3  5 -> 6 -> 7  8 -> 9
  edge [arrowhead=normal, color=gray]
  5 -> 7 6 -> 7
  subgraph { rank=same; TT; A; 1; 2; 3;}
  subgraph { rank=same; B; 5; 6; 7;}
  subgraph { rank=same; C; 8; 9;}
}
", height=280)
```

```{r, echo=FALSE}
DiagrammeR::grViz("
digraph assignunknown {
  graph [rankdir = LR, ranksep=0.2, nodesep=0.25]
  node [shape=box, fontname=Arial]
  A [label='Step 2-1. Import data']
  B [label='Step 2-2. Perform assignment\ntest and visualize results']
  
  node [shape=plaintext, fontname=Arial]
  1 [label='Use read.genpop( ), compile.data( ),\nread.table( ), or read.csv( )']
  2 [label='Known and unknown data sets\nshould be imported separately']
  5 [label='Use assign.X( )']
  6 [label='Output results and\ngenerate membership\nprobability plot']
  
  node [shape=plaintext, fontname=Arial, fontsize=20]
  TT [label='Step 2. Predict sources of unknown individuals']
  
  edge [arrowhead=normal]
  A -> B
  5 -> 6
  edge [arrowhead=tee]
  A -> 1 
  B -> 5
  edge [arrowhead=none, color=transparent]
  TT -> A
  1 -> 2
  B -> 5
  subgraph {rank=same; TT; A; 1; 2;}
  subgraph {rank=same; B; 5; 6}
}          
", height=200)

```

***
### Resampling Cross-validation Workflow {#RCVworkflow}
The diagram below illustrates the workflow of resampling cross-validation, in which individuals from each population are divided into training and test sets, and assignment test repeats through resampling training individuals. Multiple proportions of training individuals by multiple proportions of training loci (when analyzing genetic data) can be specified in one single analysis (in `assign.MC()` or `assign.kfold()`). For example, the diagram shows top 10% or 50% of high *F~ST~* loci or all loci are used as training loci. This helps evaluate whether using top 10%, 50% of high *F~ST~* loci or overall loci results in similar assignment accuracies. For more details, see [Perform population assignment](http://alexkychen.github.io/assignPOP/analyze.html#performassignment) in the [Data Analysis](http://alexkychen.github.io/assignPOP/analyze.html) page.      

```{r, echo=FALSE}
DiagrammeR::grViz("
Digraph MCCVflow {
  graph [compound=TRUE]
  
  node [shape=box fontsize=20]
  box1 [label='Individuals collected from populations A, B, C...']
  box2_1 [label='Training individuals\nfrom each population']
  box2_2 [label='Test individuals\nfrom each population'] 
  box4 [label='Principal components\nas new features']
  box5 [label='Predictive model\n(LDA/SVM/naive Bayes/\nDecision Tree/Random Forest)']
  box6 [label='Assignment result']
  
  node [shape=box fontsize=16]
  box3_1 [label='Use top 10% of high Fst\nloci as training loci']
  box3_2 [label='Use top 50% of high Fst\nloci as training loci']
  box3_3 [label='Use overall loci\nas training loci']
  
  node [shape=plaintext fontsize=20]
  box7 [label='Exit until N-time sampling is done']

  edge [fontsize=18]
  box1 -> box2_1 [label='1. Randomly subset\na proportion of individuals\nas training set; rest\nused as test set']
  box1 -> box2_2 
  box2_1 -> box3_2 [label='2. Calculate locus Fst\nbased on training individuals\nand subset a proportion of loci\nas training loci' lhead=cluster0]
  box3_2 -> box4 [label='3. Perform PCA for\ndimensionality reduction.\n(Optional for non-genetic data)' ltail=cluster0]
  box4 -> box5 [label='4. Use machine learning classifiers\nto build predictive models']
  box5 -> box2_2 [label='5. Perform assignment\non test individuals']
  box2_2 -> box6
  box6 -> box1 [label='6. Repeat assignment\nthrough resampling']
  box3_3 -> box3_2 -> box3_1 [color=transparent constraint=FALSE minlen=0]
  box6 -> box7
  
  subgraph {rank=same; box4; box6;}
  subgraph {rank=same; box2_1; box2_2}
  subgraph cluster0 {rank=same; box3_1; box3_2; box3_3;}
}
                  
")
```

***
### Package Citation 
Chen, K-Y., Marschall, E.A. Sovic M.G., Fries, A.C., Gibbs, H.L., Ludsin, S.A. (2017) assignPOP: Population Assignment using Genomic, Non-Genetic or Integrated Data in a Machine-learning Framework. R package version 1.1. https://CRAN.R-project.org/package=assignPOP

***
#### References

