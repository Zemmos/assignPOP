---
title: "assignPOP Quick Start"
author: "Kuan-Yu (Alex) Chen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{assignPOP Quick Start}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Intro to assignPOP

**assignPOP** is an R package that helps perform population assignment using a machine learning framework. It employs [supervised machine learning](https://en.wikipedia.org/wiki/Supervised_learning) methods to evaluate the discriminatory power of your known data set, and is capable of analyzing **large genetic, non-genetic, or integrated (genetic plus non-genetic) data sets**. This framework is also designed for solving the upwardly biased issue that was discussed in previous studies (Anderson 2010^[Anderson, E. C. (2010). Assessing the Power of Informative Subsets of Loci for Population Assignment: Standard Methods Are Upwardly Biased. *Molecular Ecology Resources* 10(4): 701–710.]; Waples 2010^[Waples, R. S. (2010). High-Grading Bias: Subtle Problems with Assessing Power of Selected Subsets of Loci for Population Assignment. *Molecular Ecology* 19(13): 2599–2601.]). Other features are listed below.

- Use principle component analysis (PCA) for dimensionality reduction (or data transformation)
- Use Monte-Carlo cross-validation to evaluate the variation of assignment accuracy
- Use *K*-fold cross-validation to estimate membership probability
- Allow to resample training individuals with various proportions or numbers
- Allow to resample training loci with various proportions either randomly or based on locus *F~ST~* value within training data.
- Provide several machine learning classifiers, including LDA, SVM, naive Bayes, decision tree, and random forest to build tunable predictive models.
- Output results in publication-quality plots while being editable using ggplot2 library

**This page provides a brief description and usage about the assignPOP package. For more details and up-to-date instructions, please visit our site at [http://alexkychen.github.io/assignPOP/](http://alexkychen.github.io/assignPOP/).**

## Install the package

From CRAN:
```{r, eval=FALSE}
install.packages("assignPOP")
```

From Github: 
```{r, eval=FALSE}
install.packages("devtools")
library(devtools)
install_github("alexkychen/assignPOP")
```
*Note*: When you install the package from Github, you may need to install additional packages before the assignPOP can be successfully installed. Follow the hints that R provided and then re-run `install_github("alexkychen/assignPOP")`.

To import the package, enter:
```{r, warning=FALSE}
library(assignPOP)
```

## Import data 

Import genetic data (in GENEPOP format) as follows: 
(change variable names that work for you)
```{r, eval=FALSE}
varName1 <- read.genpop("YourGenepopFileName.txt", pop.names=c("pop_A","pop_B","pop_C")) 

```

Import and concatenate genetic and non-genetic data:
```{r, eval=FALSE}
varName2 <- compile.data(varName1, "YourNonGeneticFile.csv")
```

To import non-genetic data for analyses, use `read.table()` or `read.csv()` 

***
## Assignment test for evaluating baseline data

The package provides two resampling cross-validation methods: Monte-Carlo cross-validation for evaluating assignment accuracy; *K*-fold cross-validation for estimating membership probability.

### Monte-Carlo cross-validation

Use the following function and provide necessary arguments (use `?assign.MC` to see details):
```{r, eval=FALSE}
assign.MC(varName1, train.inds=c(0.5, 0.7, 0.9), train.loci=c(0.1, 0.25, 0.5, 1), loci.sample="fst", iterations=30, model="lda", dir="ResultFolder/" )
```
The results will be saved in the `ResultFolder` you provided in the argument `dir`, so you don't need to provide a return object name.

### *K*-fold cross-validation

To perform *K*-fold cross-validation, use the following function and provide necessary arguments (use `?assign.kfold` to see details):
```{r, eval=FALSE}
assign.kfold(varName2, k.fold=c(3, 4, 5), train.loci=c(0.1, 0.25, 0.5, 1), loci.sample="random", model="svm", dir="ResultFolder2/" )
```

***
## Assignment test for predicting unknown individuals

First, make sure your baseline data and unknown data have the same data type and feature names.

Second, import both data sets (here we use integrated data as an example)
```{r, eval=FALSE}
#Import and concatenate known data 
genetic_known <- read.genpop("YourGenepop_Kn.txt", pop.names=c("A","B","C"))
integrate_known <- compile.data(genetic_known, "NonGeneticData_Kn.csv")

#Import and concatenate unknown data
genetic_unknown <- read.genpop("YourGenepop_Un.txt")
integrate_uknown <- compile.data(genetic_unknown, "NonGeneticData_Un.csv")

```

Third, perform an assignment test using a desired predictive model, for example, naive Bayes.
```{r, eval=FALSE}
assign.X(x1=integrate_known, x2=integrate_uknown, model="naiveBayes", dir="ResultFolder3/")

```
You can output a membership probability plot right after the test is done by entering "Y" in the R console.

***
## Calculate assignment accuracy 

After the baseline evaluation (`assign.MC()` or `assign.kfold()`) completes, you can calculate the assignment accuracy across the tests by using the following functions:
```{r, eval=FALSE}
#For Monte-Carlo results
accuRes_MC <- accuracy.MC(dir="ResultFolder/")

#For K-fold results
accuRes_KF <- accuracy.kfold(dir="ResultFolder2/")
```
The return object (a data frame) from the above functions can be used to make assignment accuracy box plots (see next section).

***
## Visualize assignment results

```{r, echo=FALSE}
accuRes_MC <- read.table("../inst/extdata/Rate.txt", header = T)
```

To visualize **assignment accuracy**, we make a box plot using Monte-Carlo cross-validation results as follows. 
```{r,  fig.align='center', fig.width=7, fig.asp=0.6 }
#Import ggplot2 library to fine tune the plot
library(ggplot2)

#Make an assignment accuracy box plot and set Y-axis range between 0 and 1
accuracy.plot(accuRes_MC, pop=c("all", "pop_A", "pop_B", "pop_C")) + ylim(0,1)
```

To visualize **membership probability**, we make a stacked bar plot using K-fold cross-validation results as follows.
```{r, eval=FALSE}
membership.plot(dir="ResultFolder2/", style = 1)

```

```{r, echo=FALSE, out.width="700px"}
knitr::include_graphics("Membership-genetic-morph-style1.png")
```

***
## Identify informative loci

If you are analyzing genetic data (or partially genetic), you could check which loci are frequently accounted as high *F~ST~* training loci across the assignment tests (e.g., Monte-Carlo cross-validation with sampling high *F~ST~* loci as training loci) as follows.
```{r, eval=FALSE}
# Check out top 20 high Fst loci
check.loci(dir="ResultFolder/", top.loci = 20)

```

***
## Function list

`read.genpop()` Read genetic data in GENEPOP format

`reduce.allele()` Reduce low variance loci

`compile.data()` Concatenate genetic and non-genetic data

`assign.MC()` Perform population assignment using Monte-Carlo cross-validation

`assign.kfold()` Perform population assignment using K-fold cross-validation

`assign.X()` Assign unknown individuals to source populations

`accuracy.MC()` Calculate assignment accuracy from Monte-Carlo cross-validation results

`accuracy.kfold()` Calculate assignment accuracy from K-fold cross-validation results

`accuracy.plot()` Make assignment accuracy box plots

`membership.plot()` Make membership probability stacked bar plots

`check.loci()` Identify informative loci used in resampling cross-validation

**Enter `?` and function name in R console (e.g., `?read.genpop`) to learn more about the functions and what arguments are used in the functions.**


